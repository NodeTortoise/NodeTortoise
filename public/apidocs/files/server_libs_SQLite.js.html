<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="utf-8">
    <title>server\libs\SQLite.js - API de NodeTortoise</title>
    <link rel="stylesheet" href="http://yui.yahooapis.com/3.9.1/build/cssgrids/cssgrids-min.css">
    <link rel="stylesheet" href="../assets/vendor/prettify/prettify-min.css">
    <link rel="stylesheet" href="../assets/css/main.css" id="site_styles">
    <link rel="icon" href="../assets/favicon.ico">
    <script src="http://yui.yahooapis.com/combo?3.9.1/build/yui/yui-min.js"></script>
</head>
<body class="yui3-skin-sam">

<div id="doc">
    <div id="hd" class="yui3-g header">
        <div class="yui3-u-3-4">
                <h1><img src="../assets/css/logo.png" title="API de NodeTortoise" width="117" height="52"></h1>
        </div>
        <div class="yui3-u-1-4 version">
            <em>API Docs for: 1.0.0</em>
        </div>
    </div>
    <div id="bd" class="yui3-g">

        <div class="yui3-u-1-4">
            <div id="docs-sidebar" class="sidebar apidocs">
                <div id="api-list">
                    <h2 class="off-left">APIs</h2>
                    <div id="api-tabview" class="tabview">
                        <ul class="tabs">
                            <li><a href="#api-classes">Classes</a></li>
                            <li><a href="#api-modules">Modules</a></li>
                        </ul>
                
                        <div id="api-tabview-filter">
                            <input type="search" id="api-filter" placeholder="Type to filter APIs">
                        </div>
                
                        <div id="api-tabview-panel">
                            <ul id="api-classes" class="apis classes">
                                <li><a href="../classes/App.html">App</a></li>
                            </ul>
                
                
                            <ul id="api-modules" class="apis modules">
                            </ul>
                        </div>
                    </div>
                </div>
            </div>
        </div>
        <div class="yui3-u-3-4">
                <div id="api-options">
                    Show:
                    <label for="api-show-inherited">
                        <input type="checkbox" id="api-show-inherited" checked>
                        Inherited
                    </label>
            
                    <label for="api-show-protected">
                        <input type="checkbox" id="api-show-protected">
                        Protected
                    </label>
            
                    <label for="api-show-private">
                        <input type="checkbox" id="api-show-private">
                        Private
                    </label>
                    <label for="api-show-deprecated">
                        <input type="checkbox" id="api-show-deprecated">
                        Deprecated
                    </label>
            
                </div>
            
            <div class="apidocs">
                <div id="docs-main">
                    <div class="content">
<h1 class="file-heading">File: server\libs\SQLite.js</h1>

<div class="file">
    <pre class="code prettyprint linenums">
/* global require */

/**
 * Description
 * @param {} file
 * @return 
 */
SQLite = function (file) {

    var db;
    var self = this;
    this.debug = false;

    /**
     * Description
     * @method insert
     * @param {} table
     * @param {} fields
     * @param {} values
     * @param {} onSuccess
     * @param {} onError
     * @return 
     */
    this.insert = function (table, fields, values, onSuccess, onError) {
        try {
            var strFields = (fields) ? &#x27; (&#x27; + fields + &#x27;)&#x27; : &#x27;&#x27;;
            var strValues = getQueryValues(values);
            var query = &#x27;INSERT INTO &#x27; + table + strFields + &#x27; VALUES(&#x27; + strValues + &#x27;)&#x27;;
            debug(query);
            db.serialize(function () {
                var stmt = db.prepare(query);
                stmt[&#x27;run&#x27;].apply(stmt, values);
                stmt.finalize();
            });
        } catch (err) {
            throw err;
        }
    };

    /**
     * Description
     * @method select
     * @param {} table
     * @param {} fields
     * @param {} onSuccess
     * @param {} onError
     * @return 
     */
    this.select = function (table, fields, onSuccess, onError) {
        try {
            var strFields = (fields) ? fields : &#x27;*&#x27;;
            var query = &#x27;SELECT &#x27; + strFields + &#x27; FROM &#x27; + table;
            /**
             * Description
             * @method callback
             * @param {} error
             * @param {} result
             * @return 
             */
            var callback = function (error, result) {
                onCallback(query, onSuccess, onError, error, result);
            };
            debug(query);
            db.all(query, callback);
        } catch (err) {
            onError(err);
        }
    };

    /**
     * Description
     * @method selectWhere
     * @param {} table
     * @param {} fields
     * @param {} filters
     * @param {} onSuccess
     * @param {} onError
     * @return 
     */
    this.selectWhere = function (table, fields, filters, onSuccess, onError) {
    };

    /**
     * Description
     * @method delete
     * @param {} table
     * @param {} filters
     * @param {} onSuccess
     * @param {} onError
     * @return 
     */
    this.delete = function (table, filters, onSuccess, onError) {
        try {
            if (!filters || (filters.isArray &amp;&amp; filters.length &lt; 1)) {
                throw new Error(&#x27;Delete method need at leats one filter&#x27;);
            }
            var queryFilters = getQueryFilters(filters);
            var query = &#x27;DELETE FROM &#x27; + table + &#x27; WHERE (&#x27; + queryFilters.where + &#x27;)&#x27;;
            /**
             * Description
             * @method callback
             * @param {} error
             * @param {} result
             * @return 
             */
            var callback = function (error, result) {
                onCallback(query, onSuccess, onError, error, result);
            };
            debug(query);
            db.run(query, queryFilters.values, callback);
        } catch (err) {
            onError(err);
        }
    };

    /**
     * Description
     * @method onCallback
     * @param {} query
     * @param {} onSuccess
     * @param {} onError
     * @param {} error
     * @param {} result
     * @return 
     */
    var onCallback = function (query, onSuccess, onError, error, result) {
        if (error) {
            var errorMessage = (error &amp;&amp; error.hasOwnProperty(&#x27;message&#x27;)) ? error.message : error;
            errorMessage += (&#x27; [query = &#x27; + query + &#x27;]&#x27;);
            onError(errorMessage);
        } else {
            onSuccess(result);
        }
    };

    /**
     * Description
     * @method getQueryFilters
     * @param {} filters
     * @return ObjectExpression
     */
    var getQueryFilters = function (filters) {
        var strFilters = &#x27;&#x27;;
        var values = [];
        for (var filterKey in filters) {
            strFilters += (filterKey + &#x27; = ? AND &#x27;);
            values.push(filters[filterKey]);
        }
        strFilters = strFilters.substring(0, strFilters.length - 5);
        return {&#x27;where&#x27;: strFilters, &#x27;values&#x27;: values};
    };

    /**
     * Description
     * @method getQueryValues
     * @param {} values
     * @return strValues
     */
    var getQueryValues = function (values) {
        var strValues = &#x27;&#x27;;
        for (var i = 0; i &lt; values.length; ++i) {
            strValues += &#x27;?,&#x27;;
        }
        strValues = strValues.substring(0, strValues.length - 1);
        return strValues;
    };

    /**
     * Description
     * @method getDB
     * @return db
     */
    this.getDB = function () {
        return db;
    };

    /**
     * Description
     * @method debug
     * @param {} message
     * @return 
     */
    var debug = function (message) {
        if (self.debug) {
            console.log(&#x27;SQLite: &#x27; + message);
        }
    };

    /**
     * Description
     * @method __construc
     * @return 
     */
    var __construc = function () {
        try {
            var sqlite3 = require(&#x27;sqlite3&#x27;).verbose();
            db = new sqlite3.Database(file);
        }
        catch (err) {
            throw err;
        }
    };

    __construc();

};
    </pre>
</div>
                    </div>
                </div>
            </div>
        </div>
    </div>
</div>
<script src="../assets/vendor/prettify/prettify-min.js"></script>
<script>prettyPrint();</script>
<script src="../assets/js/yui-prettify.js"></script>
<script src="../assets/../api.js"></script>
<script src="../assets/js/api-filter.js"></script>
<script src="../assets/js/api-list.js"></script>
<script src="../assets/js/api-search.js"></script>
<script src="../assets/js/apidocs.js"></script>
</body>
</html>
